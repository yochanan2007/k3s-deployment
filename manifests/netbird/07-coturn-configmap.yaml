apiVersion: v1
kind: ConfigMap
metadata:
  name: coturn-config
  namespace: netbird
data:
  turnserver.conf: |
    listening-port=3478
    tls-listening-port=5349

    # TURN server name and realm
    realm=netbird.k3s.dahan.house
    server-name=coturn.netbird.k3s.dahan.house

    # Use fingerprints in TURN messages
    fingerprint

    # Log file path
    log-file=stdout

    # Disable log file rotation
    no-stdout-log

    # Enable verbose logging (for debugging)
    verbose

    # Specify the user quota for TURN
    user-quota=0
    total-quota=0

    # Enable long-term credential mechanism
    lt-cred-mech

    # Static user credentials (user:password format)
    # In production, use secrets for this
    user=netbird:netbird123

    # Deny peer connections from private IP ranges (security)
    no-multicast-peers

    # Allow TURN REST API
    use-auth-secret
    static-auth-secret=netbird-secret-change-me

    # Mobility support
    mobility

    # Disable TLS and DTLS for simplicity (enable in production)
    no-tls
    no-dtls
---
